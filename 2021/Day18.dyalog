e←{d v←⍵ ⋄ 0=≢x←⍸(d≥5)∧0,⍨2=/d:d v ⋄ i←⊃x ⋄ v←0,v,0 ⋄ v[i]+←v[i+1] ⋄ v[i+3]+←v[i+2] ⋄ v[i+1]←0 ⋄ ((1+i)(↑,1↓↓)1-⍨@i⊢d)((1+i)(↑,1↓↓)¯1↓1↓v)}
s←{d v←⍵ ⋄ 0=≢x←⍸v≥10:d v ⋄ i←⊃x ⋄ (∊(⊂1 1)+@i⊢d)(∊(⊂(⌊,⌈)v[i]÷2)@i⊢v)}
f←{↓(⊂0 2)⌷⍉{⍵⌿⍨3=⊢/⍵}⎕JSON⍠'M'⊢⍵}
add←{(s e⍣≡)⍣≡1+@0⊢⍺,¨⍵}
mag←{d v←⍵ ⋄ 1≡≢v:⊃v ⋄ m←1+.5<+\÷2*d ⋄ 3 2+.×∇¨↓⍉↑(m⊆d-1)(m⊆v)}
mag⊃add⍨/⌽data←f¨⊃⎕NGET'Day 18.txt'1 ⍝ part 1
⌈/,mag¨∘.add⍨data ⍝ part 2
